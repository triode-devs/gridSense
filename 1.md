# ğŸ  GridSense Consumer API Documentation

This document contains only the endpoints required for the **End Consumer (Customer)** mobile app and portal. It excludes all Admin and Super Admin management endpoints.

---

## ğŸ” 1. Authentication
Endpoints for customers to manage their accounts.

### ğŸ“Œ User Registration
`POST /auth/register`
- **Description**: Creates a new customer account.
- **Body**:
  ```json
  {
    "username": "customer_name",
    "password": "secure_password"
  }
  ```
- **Response (201)**:
  ```json
  {
    "success": true,
    "data": { "userid": "gs_u101", "username": "customer_name", "role": "user" }
  }
  ```

### ğŸ“Œ Login
`POST /auth/login`
- **Description**: Returns a JWT token (valid for 24 hours).
- **Body**: `{ "username": "...", "password": "..." }`
- **Response**: 
  ```json
  {
    "success": true,
    "token": "JWT_TOKEN_HERE",
    "data": { "user": { "userid": "...", "username": "...", "role": "user" } }
  }
  ```

### ğŸ“Œ Session Verify
`GET /auth/verify`
- **Description**: Checks if the current token is still valid. Useful for auto-login on app startup.

---

## âš¡ 2. Consumption & Billing
Endpoints for tracking electricity usage and monthly costs.

### ğŸ“Œ My Monthly Bill
`GET /users/billing/[consumer_id]`
- **Description**: Detailed breakdown of the current month's estimated bill and last 6 months of history.
- **Response**:
  ```json
  {
    "success": true,
    "data": {
      "consumer": { "consumer_name": "...", "current_month_kwh": 250 },
      "billing_history": [ { "year": 2026, "month": 1, "monthly_kwh": 180 } ],
      "applicable_tariffs": [ { "rate_per_unit": 4.5, "base_pay": 50 } ]
    }
  }
  ```

### ğŸ“Œ Usage Summary
`GET /users/usage/summary`
- **Description**: Returns total kWh used across all meters owned by the user.
- **Query Params**: `?userid=[id]`
- **Response**: ` { "totals": { "total_lifetime": 4500, "total_current_month": 125 } } `

---

## ğŸ› ï¸ 3. Service & Status
Endpoints for checking power availability and meter details.

### ğŸ“Œ My Linked Meters
`GET /users/consumers`
- **Description**: Lists all physical meters registered to your account.
- **Query Params**: `?userid=[id]`
- **Response**: Returns IDs, addresses, and physical locations of your meters.

### ğŸ“Œ Live Power Status
`GET /users/consumers/[id]/status`
- **Description**: Instant check if power is currently ON or OFF for a specific meter.
- **Response (Power OFF)**:
  ```json
  {
    "success": true,
    "status": "power_off",
    "details": { "start_time": "2026-02-22T10:00:00Z", "message": "Power outage reported" }
  }
  ```

### ğŸ“Œ Grid Tariffs
`GET /users/tariff`
- **Description**: View the current electricity rates for Consumer, Commercial, and Agri categories.

---

## ğŸ’¡ Summary for Developers
- **Auth**: Use the JWT token in the `Authorization: Bearer <token>` header for all requests.
- **IDs**: Use the `consumer_id` (e.g., `gs_c1`) for all billing and status queries.
- **Unit**: All usage values are provided in **kWh**.
